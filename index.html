<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xsukax Markdown Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif; }
        .tab-active { border-bottom: 2px solid #fd8c73; color: #24292f; font-weight: 600; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #57606a; }
        .tab-inactive:hover { color: #24292f; border-bottom-color: #d0d7de; }
        .upload-zone:hover { border-color: #0969da; background-color: #ddf4ff; }
        .upload-zone.dragover { border-color: #0969da; background-color: #ddf4ff; transform: scale(1.01); }
        .markdown-content h1 { font-size: 2em; font-weight: 600; padding-bottom: 0.3em; border-bottom: 1px solid #d0d7de; margin-top: 24px; margin-bottom: 16px; }
        .markdown-content h2 { font-size: 1.5em; font-weight: 600; padding-bottom: 0.3em; border-bottom: 1px solid #d0d7de; margin-top: 24px; margin-bottom: 16px; }
        .markdown-content h3 { font-size: 1.25em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; }
        .markdown-content h4 { font-size: 1em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; }
        .markdown-content h5 { font-size: 0.875em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; }
        .markdown-content h6 { font-size: 0.85em; font-weight: 600; color: #57606a; margin-top: 24px; margin-bottom: 16px; }
        .markdown-content p { margin-top: 0; margin-bottom: 16px; }
        .markdown-content ul, .markdown-content ol { padding-left: 2em; margin-top: 0; margin-bottom: 16px; }
        .markdown-content li { margin-top: 0.25em; }
        .markdown-content li + li { margin-top: 0.25em; }
        .markdown-content blockquote { padding: 0 1em; color: #57606a; border-left: 0.25em solid #d0d7de; margin: 0 0 16px 0; }
        .markdown-content blockquote > :first-child { margin-top: 0; }
        .markdown-content blockquote > :last-child { margin-bottom: 0; }
        .markdown-content code { padding: 0.2em 0.4em; margin: 0; font-size: 85%; background-color: rgba(175,184,193,0.2); border-radius: 6px; font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace; }
        .markdown-content pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; background-color: #f6f8fa; border-radius: 6px; margin-bottom: 16px; }
        .markdown-content pre code { display: inline; max-width: auto; padding: 0; margin: 0; overflow: visible; line-height: inherit; word-wrap: normal; background-color: transparent; border: 0; }
        .markdown-content table { border-spacing: 0; border-collapse: collapse; margin-top: 0; margin-bottom: 16px; display: block; width: max-content; max-width: 100%; overflow: auto; }
        .markdown-content table tr { background-color: #ffffff; border-top: 1px solid #d0d7de; }
        .markdown-content table tr:nth-child(2n) { background-color: #f6f8fa; }
        .markdown-content table th { padding: 6px 13px; border: 1px solid #d0d7de; font-weight: 600; }
        .markdown-content table td { padding: 6px 13px; border: 1px solid #d0d7de; }
        .markdown-content a { color: #0969da; text-decoration: none; }
        .markdown-content a:hover { text-decoration: underline; }
        .markdown-content img { max-width: 100%; box-sizing: content-box; background-color: #ffffff; border-radius: 6px; }
        .markdown-content hr { height: 0.25em; padding: 0; margin: 24px 0; background-color: #d0d7de; border: 0; }
        .notification { position: fixed; top: 16px; right: 16px; z-index: 1000; transform: translateX(400px); transition: transform 0.3s ease-in-out; max-width: 320px; }
        .notification.show { transform: translateX(0); }
        .mermaid-wrapper { background: #ffffff; border: 1px solid #d0d7de; border-radius: 6px; padding: 16px; margin: 16px 0; text-align: center; overflow-x: auto; }
        @media (max-width: 768px) { .notification { max-width: calc(100vw - 32px); } }
    </style>
</head>
<body class="bg-white">
    <div id="notification" class="notification"></div>
    
    <div class="min-h-screen flex flex-col">
        <header class="bg-[#24292f] border-b border-[#d0d7de]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-sm">X</div>
                        <h1 class="text-white text-lg font-semibold">xsukax Markdown Viewer</h1>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-gray-400">
                        <span class="hidden sm:inline">Mermaid v10.9.1</span>
                        <span class="hidden md:inline">‚Ä¢</span>
                        <span class="hidden md:inline">GitHub Design</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="bg-white border border-[#d0d7de] rounded-lg shadow-sm">
                <div class="border-b border-[#d0d7de]">
                    <nav class="flex gap-4 px-6" aria-label="Tabs">
                        <button id="uploadTab" class="tab-active py-3 px-1 text-sm transition-all" onclick="switchTab('upload')">
                            üìÅ Upload File
                        </button>
                        <button id="pasteTab" class="tab-inactive py-3 px-1 text-sm transition-all" onclick="switchTab('paste')">
                            ‚úèÔ∏è Paste Markdown
                        </button>
                    </nav>
                </div>

                <div id="uploadSection" class="p-6">
                    <div id="uploadArea" class="upload-zone border-2 border-dashed border-[#d0d7de] rounded-lg p-12 text-center cursor-pointer transition-all">
                        <div class="text-6xl mb-4">üìÑ</div>
                        <label for="fileInput" class="block text-base font-semibold text-[#24292f] mb-2 cursor-pointer">
                            Drop markdown file here or click to browse
                        </label>
                        <p class="text-sm text-[#57606a] mb-4">Supports .md and .markdown files with Mermaid diagrams</p>
                        <input type="file" id="fileInput" class="hidden" accept=".md,.markdown">
                        <div id="fileInfo" class="text-sm text-[#0969da] font-medium mt-3"></div>
                    </div>
                </div>

                <div id="pasteSection" class="p-6 hidden">
                    <div class="space-y-4">
                        <div>
                            <label for="markdownInput" class="block text-sm font-semibold text-[#24292f] mb-2">
                                Paste your markdown content below
                            </label>
                            <textarea 
                                id="markdownInput" 
                                rows="12" 
                                class="w-full px-3 py-2 border border-[#d0d7de] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#0969da] focus:border-transparent font-mono text-sm resize-y"
                                placeholder="# Your Markdown Here

Start typing or paste your markdown content...

```mermaid
graph TD
    A[Start] --> B[Process]
    B --> C[End]
```"></textarea>
                        </div>
                        <div class="flex gap-3">
                            <button 
                                onclick="renderPastedMarkdown()" 
                                class="flex-1 sm:flex-none px-4 py-2 bg-[#2da44e] text-white text-sm font-medium rounded-lg hover:bg-[#2c974b] focus:outline-none focus:ring-2 focus:ring-[#2da44e] focus:ring-offset-2 transition-colors">
                                ‚ú® Render Markdown
                            </button>
                            <button 
                                onclick="clearMarkdownInput()" 
                                class="px-4 py-2 bg-white text-[#24292f] text-sm font-medium rounded-lg border border-[#d0d7de] hover:bg-[#f6f8fa] focus:outline-none focus:ring-2 focus:ring-[#d0d7de] focus:ring-offset-2 transition-colors">
                                üóëÔ∏è Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-white border border-[#d0d7de] rounded-lg shadow-sm">
                <div class="border-b border-[#d0d7de] px-6 py-3">
                    <h2 class="text-sm font-semibold text-[#24292f]">Preview</h2>
                </div>
                <div class="p-6">
                    <div id="markdownContent" class="markdown-content text-[#24292f]">
                        <h1>Welcome to xsukax Markdown Viewer</h1>
                        <p>A modern markdown viewer with GitHub-inspired design and advanced features.</p>
                        
                        <blockquote>
                            <p><strong>Features at a glance:</strong></p>
                            <ul>
                                <li>üìÅ Upload markdown files or paste content directly</li>
                                <li>üìñ Full markdown support with syntax highlighting</li>
                                <li>üìä Interactive Mermaid diagrams</li>
                                <li>üé® Clean GitHub-inspired interface</li>
                                <li>üì± Mobile-first responsive design</li>
                                <li>‚ö° Lightning-fast performance</li>
                            </ul>
                        </blockquote>
                        
                        <h2>Getting Started</h2>
                        <p>Choose your preferred method:</p>
                        <ol>
                            <li><strong>Upload File:</strong> Drag and drop or browse for a .md file</li>
                            <li><strong>Paste Markdown:</strong> Copy and paste your markdown content directly</li>
                        </ol>
                        
                        <h2>Mermaid Diagram Example</h2>
                        <p>Experience beautiful diagram rendering:</p>
                        <div class="mermaid-wrapper">
                            <div class="mermaid" data-mermaid-source="flowchart%20LR%0A%20%20%20%20A%5BUpload%20File%5D%20--%3E%20C%7BProcess%7D%0A%20%20%20%20B%5BPaste%20Markdown%5D%20--%3E%20C%0A%20%20%20%20C%20--%3E%20D%5BRender%20Diagrams%5D%0A%20%20%20%20C%20--%3E%20E%5BParse%20Markdown%5D%0A%20%20%20%20D%20--%3E%20F%5BDisplay%20Content%5D%0A%20%20%20%20E%20--%3E%20F%0A%20%20%20%20F%20--%3E%20G%5BEnjoy!%5D%0A%20%20%20%20%0A%20%20%20%20style%20A%20fill%3A%230969da%2Cstroke%3A%23fff%2Cstroke-width%3A2px%2Ccolor%3A%23fff%0A%20%20%20%20style%20B%20fill%3A%230969da%2Cstroke%3A%23fff%2Cstroke-width%3A2px%2Ccolor%3A%23fff%0A%20%20%20%20style%20G%20fill%3A%232da44e%2Cstroke%3A%23fff%2Cstroke-width%3A2px%2Ccolor%3A%23fff">flowchart LR
    A[Upload File] --> C{Process}
    B[Paste Markdown] --> C
    C --> D[Render Diagrams]
    C --> E[Parse Markdown]
    D --> F[Display Content]
    E --> F
    F --> G[Enjoy!]
    
    style A fill:#0969da,stroke:#fff,stroke-width:2px,color:#fff
    style B fill:#0969da,stroke:#fff,stroke-width:2px,color:#fff
    style G fill:#2da44e,stroke:#fff,stroke-width:2px,color:#fff</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-[#f6f8fa] border-t border-[#d0d7de] mt-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-3 text-sm text-[#57606a]">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-[#2da44e]"></div>
                        <span id="statusText">Ready to load markdown files</span>
                    </div>
                    <div class="text-xs">Built with ‚ù§Ô∏è by xsukax</div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        let mermaidDiagrams = new Map();
        let mermaidCounter = 0;

        mermaid.initialize({
            startOnLoad: false,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#0969da',
                primaryTextColor: '#24292f',
                primaryBorderColor: '#0969da',
                lineColor: '#57606a',
                secondaryColor: '#f6f8fa',
                tertiaryColor: '#ffffff',
                fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'
            },
            securityLevel: 'loose',
            flowchart: { nodeSpacing: 50, rankSpacing: 50, curve: 'basis' }
        });

        const renderer = new marked.Renderer();
        renderer.code = function(code, language) {
            if (language === 'mermaid') {
                mermaidCounter++;
                const id = `mermaid-${mermaidCounter}`;
                mermaidDiagrams.set(id, code.trim());
                return `<div class="mermaid-wrapper"><div class="mermaid" id="${id}" data-mermaid-source="${encodeURIComponent(code.trim())}">${code.trim()}</div></div>`;
            } else {
                if (language && hljs.getLanguage(language)) {
                    try {
                        const highlighted = hljs.highlight(code, { language }).value;
                        return `<pre><code class="hljs language-${language}">${highlighted}</code></pre>`;
                    } catch (err) {}
                }
                try {
                    const highlighted = hljs.highlightAuto(code).value;
                    return `<pre><code class="hljs">${highlighted}</code></pre>`;
                } catch (err) {}
                return `<pre><code>${code}</code></pre>`;
            }
        };

        marked.setOptions({ renderer: renderer, breaks: true, gfm: true });

        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-[#dafbe1] border-[#2da44e] text-[#1a7f37]',
                error: 'bg-[#ffebe9] border-[#cf222e] text-[#a40e26]',
                info: 'bg-[#ddf4ff] border-[#0969da] text-[#0550ae]',
                warning: 'bg-[#fff8c5] border-[#bf8700] text-[#7d4e00]'
            };
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è'
            };

            const notification = document.getElementById('notification');
            notification.innerHTML = `
                <div class="${colors[type]} border rounded-lg shadow-lg p-4">
                    <div class="flex items-start gap-3">
                        <span class="text-xl">${icons[type]}</span>
                        <div class="flex-1">
                            <p class="font-medium text-sm">${message}</p>
                        </div>
                        <button onclick="hideNotification()" class="text-current opacity-50 hover:opacity-100 transition-opacity">
                            <span class="text-xl">√ó</span>
                        </button>
                    </div>
                </div>
            `;
            notification.classList.add('show');
            setTimeout(() => hideNotification(), 5000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
        }

        function switchTab(tab) {
            const uploadTab = document.getElementById('uploadTab');
            const pasteTab = document.getElementById('pasteTab');
            const uploadSection = document.getElementById('uploadSection');
            const pasteSection = document.getElementById('pasteSection');

            if (tab === 'upload') {
                uploadTab.className = 'tab-active py-3 px-1 text-sm transition-all';
                pasteTab.className = 'tab-inactive py-3 px-1 text-sm transition-all';
                uploadSection.classList.remove('hidden');
                pasteSection.classList.add('hidden');
            } else {
                uploadTab.className = 'tab-inactive py-3 px-1 text-sm transition-all';
                pasteTab.className = 'tab-active py-3 px-1 text-sm transition-all';
                uploadSection.classList.add('hidden');
                pasteSection.classList.remove('hidden');
            }
        }

        async function processMermaidDiagrams() {
            const mermaidElements = document.querySelectorAll('.mermaid');
            
            for (let i = 0; i < mermaidElements.length; i++) {
                const element = mermaidElements[i];
                try {
                    let code;
                    const sourceAttr = element.getAttribute('data-mermaid-source');
                    
                    if (sourceAttr) {
                        code = decodeURIComponent(sourceAttr).trim();
                    } else if (mermaidDiagrams.has(element.id)) {
                        code = mermaidDiagrams.get(element.id);
                    } else {
                        const textContent = element.textContent.trim();
                        if (textContent && !textContent.includes('<')) {
                            code = textContent;
                        } else {
                            throw new Error('No valid diagram source found');
                        }
                    }
                    
                    const renderId = `mermaid-render-${Date.now()}-${i}`;
                    const { svg } = await mermaid.render(renderId, code);
                    element.innerHTML = svg;
                    
                } catch (error) {
                    console.error('Mermaid rendering error:', error);
                    element.innerHTML = `<div class="bg-[#ffebe9] border border-[#cf222e] text-[#a40e26] p-4 rounded-lg text-sm">
                        <strong>Diagram Rendering Error</strong><br>
                        ${error.message || 'Failed to render diagram'}
                    </div>`;
                }
            }
        }

        async function handleFile(file) {
            if (!file) return;
            
            if (!file.name.match(/\.(md|markdown)$/i)) {
                showNotification('Please select a valid markdown file (.md)', 'error');
                return;
            }

            document.getElementById('fileInfo').textContent = `üìÑ ${file.name}`;
            updateStatus('Loading file...');

            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const markdownText = e.target.result;
                    mermaidCounter = 0;
                    mermaidDiagrams.clear();
                    
                    const html = marked.parse(markdownText);
                    document.getElementById('markdownContent').innerHTML = html;
                    
                    const mermaidElements = document.querySelectorAll('.mermaid');
                    if (mermaidElements.length > 0) {
                        updateStatus('Processing diagrams...');
                        setTimeout(async () => {
                            try {
                                await processMermaidDiagrams();
                                updateStatus(`Successfully loaded with ${mermaidElements.length} diagram(s)`);
                                showNotification(`File loaded with ${mermaidElements.length} diagram(s)`, 'success');
                            } catch (error) {
                                updateStatus('File loaded - Some diagrams failed to render');
                                showNotification('Some diagrams failed to render', 'warning');
                            }
                        }, 50);
                    } else {
                        updateStatus('File loaded successfully');
                        showNotification('File loaded successfully', 'success');
                    }
                } catch (error) {
                    updateStatus('Error processing file');
                    showNotification(`Error: ${error.message}`, 'error');
                }
            };

            reader.onerror = function() {
                updateStatus('Error reading file');
                showNotification('Error reading file', 'error');
            };

            reader.readAsText(file);
        }

        async function renderPastedMarkdown() {
            const markdownInput = document.getElementById('markdownInput');
            const markdownText = markdownInput.value.trim();
            
            if (!markdownText) {
                showNotification('Please enter some markdown content', 'warning');
                return;
            }

            try {
                mermaidCounter = 0;
                mermaidDiagrams.clear();
                
                const html = marked.parse(markdownText);
                document.getElementById('markdownContent').innerHTML = html;
                
                const mermaidElements = document.querySelectorAll('.mermaid');
                if (mermaidElements.length > 0) {
                    updateStatus('Processing diagrams...');
                    setTimeout(async () => {
                        try {
                            await processMermaidDiagrams();
                            updateStatus(`Rendered with ${mermaidElements.length} diagram(s)`);
                            showNotification('Markdown rendered successfully', 'success');
                        } catch (error) {
                            updateStatus('Rendered - Some diagrams failed');
                            showNotification('Some diagrams failed to render', 'warning');
                        }
                    }, 50);
                } else {
                    updateStatus('Markdown rendered successfully');
                    showNotification('Markdown rendered successfully', 'success');
                }
            } catch (error) {
                updateStatus('Error rendering markdown');
                showNotification(`Error: ${error.message}`, 'error');
            }
        }

        function clearMarkdownInput() {
            document.getElementById('markdownInput').value = '';
            showNotification('Input cleared', 'info');
        }

        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');

        fileInput.addEventListener('change', function(e) {
            e.stopPropagation();
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        uploadArea.addEventListener('click', function(e) {
            if (e.target !== fileInput) {
                e.preventDefault();
                e.stopPropagation();
                fileInput.click();
            }
        });

        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (!uploadArea.contains(e.relatedTarget)) {
                uploadArea.classList.remove('dragover');
            }
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFile(files[0]);
            }
        });

        document.addEventListener('dragover', e => e.preventDefault());
        document.addEventListener('drop', e => e.preventDefault());

        // Enter key to render in textarea
        document.getElementById('markdownInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                renderPastedMarkdown();
            }
        });

        window.addEventListener('load', async function() {
            setTimeout(async () => {
                await processMermaidDiagrams();
                updateStatus('Ready to load markdown files');
            }, 100);
        });
    </script>
</body>
</html>
